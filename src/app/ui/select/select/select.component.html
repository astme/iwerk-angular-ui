<div tabindex="0"
  iwSelectLabel
  (open)="onLabelClick()"
  iwSelectHighlightCtrl
  [highlightCtrlDisabled]="!(displayOptions | async)"
  (blur)="onBlurLabel()"
  (up)="onUp()"
  (down)="onDown()"
  (enter)="onEnter()">
  <ng-template [ngIf]="selection | async">
    <ng-template [ngIf]="labelTemplate">
      <ng-container *ngTemplateOutlet="labelTemplate; context: getLabelTemplateContext(selection | async)"></ng-container>        
    </ng-template>
    <ng-template [ngIf]="!labelTemplate">
      {{(selection | async).label}}
    </ng-template>        
  </ng-template>
  <ng-template [ngIf]="!(selection | async)">{{placeholder}}</ng-template>
</div>

<ng-template [ngIf]="displayOptions | async">
  <ng-template [ngIf]="autocomplete">
    <input type="text"
      [ngModel]="search | async"
      (ngModelChange)="onSearchChange($event)"
      iwSelectSearchInput
      [iwAutofocusInput]="true"
      iwSelectHighlightCtrl
      (up)="onUp()"
      (down)="onDown()"
      (enter)="onEnter()"
      (blur)="onBlur()"
      [placeholder]="placeholder"
    />
  </ng-template>
  <ul class="iw-select__options-list" iwSelectOptionList>
    <ng-template ngFor [ngForOf]="optionsToShow | async" let-option>
      <li [iwSelectOptionListItem]="option"
        class="iw-select__options-list__item"
        highlightedClass="active"
        (focus)="select(option)">
        <ng-template [ngIf]="!optionListItemTemplate">
          {{option.label}}
        </ng-template>
        <ng-template [ngIf]="optionListItemTemplate">
          <ng-container *ngTemplateOutlet="optionListItemTemplate; context: getLabelTemplateContext(option)"></ng-container>
        </ng-template>
      </li>
    </ng-template>
  </ul>
</ng-template>